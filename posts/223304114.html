<!doctype html>
<html>

<head>
  <meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="keywords" content="" />
<link rel="stylesheet" href="/css/style.css" />

  <title>
Vue JSON 博客(AcyOrt/Vue/Vuex/Webpack) - Recordum
</title>
</head>

<body>

<div class="main">
<div class="inner">
  
<div class="header">
    <a class="logo" href="/">Recordum</a><!--

 --><div class="menu">
        <a href="/archives/">Archives</a><a href="/about/">About</a>
    </div>

    <div class="social">
        <a target="_blank" href="https://github.com/LoeiFy/Recordum/issues"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
<path d="M12,2A10,10 0 0,0 2,12C2,16.42 4.87,20.17 8.84,21.5C9.34,21.58 9.5,21.27 9.5,21C9.5,20.77 9.5,20.14 9.5,19.31C6.73,19.91 6.14,17.97 6.14,17.97C5.68,16.81 5.03,16.5 5.03,16.5C4.12,15.88 5.1,15.9 5.1,15.9C6.1,15.97 6.63,16.93 6.63,16.93C7.5,18.45 8.97,18 9.54,17.76C9.63,17.11 9.89,16.67 10.17,16.42C7.95,16.17 5.62,15.31 5.62,11.5C5.62,10.39 6,9.5 6.65,8.79C6.55,8.54 6.2,7.5 6.75,6.15C6.75,6.15 7.59,5.88 9.5,7.17C10.29,6.95 11.15,6.84 12,6.84C12.85,6.84 13.71,6.95 14.5,7.17C16.41,5.88 17.25,6.15 17.25,6.15C17.8,7.5 17.45,8.54 17.35,8.79C18,9.5 18.38,10.39 18.38,11.5C18.38,15.32 16.04,16.16 13.81,16.41C14.17,16.72 14.5,17.33 14.5,18.26C14.5,19.6 14.5,20.68 14.5,21C14.5,21.27 14.66,21.59 15.17,21.5C19.14,20.16 22,16.42 22,12A10,10 0 0,0 12,2Z"></path>
</svg></a><!--
    --><a target="_blank" href="/rss.xml"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
<path d="M6.18,15.64A2.18,2.18 0 0,1 8.36,17.82C8.36,19 7.38,20 6.18,20C5,20 4,19 4,17.82A2.18,2.18 0 0,1 6.18,15.64M4,4.44A15.56,15.56 0 0,1 19.56,20H16.73A12.73,12.73 0 0,0 4,7.27V4.44M4,10.1A9.9,9.9 0 0,1 13.9,20H11.07A7.07,7.07 0 0,0 4,12.93V10.1Z"></path>
</svg></a>
    </div>
</div>




<div id="post" class="center">

    <p class="time">April 27, 2017</p>

    <h1 class="title">Vue JSON 博客(AcyOrt/Vue/Vuex/Webpack)</h1>

    <div class="content"><p>尝试使用 <a href="https://github.com/acyortjs/acyort">AcyOrt </a> 的 JSON 输出功能构建一个博客，顺便用了 vue + webpack 组合开发。</p>
<p>DEMO: <a href="http://aksdj4.am0200.com/">http://aksdj4.am0200.com/</a></p>
<p>项目地址: <a href="https://github.com/acyortjs/aksdj4">https://github.com/acyortjs/aksdj4</a></p>
<h3 id="内容json">内容 JSON</h3><p>使用  <a href="https://github.com/acyortjs/acyort">AcyOrt </a> 将项目 <a href="https://github.com/LoeiFy/Recordum/issues">Recordum</a> issue 生成 JSON: <a href="https://github.com/acyortjs/aksdj4/tree/gh-pages/json">https://github.com/acyortjs/aksdj4/tree/gh-pages/json</a></p>
<h3 id="开发选择">开发选择</h3><p>基于 webpack 2 + vue 2，值得注意的是 <code>vue-loader</code> 已经包含了 <code>vue-hot-reload-api</code>, <code>vue-style-loader</code>，甚至 postcss，所以 vue 相关的 loader 只需要安装 <code>vue-loader</code>, <code>vue-template-compiler</code></p>
<blockquote>
<p>ES6</p>
</blockquote>
<p>因为我并没有用到很多 ES7 以上的特性，只用到 <code>Object rest spread</code> 所以 babel 插件选择了
<code>babel-plugin-transform-object-rest-spread</code>, <code>babel-preset-es2015</code></p>
<blockquote>
<p>CSS 预处理器</p>
</blockquote>
<p>这次使用了 <code>postcss</code>，没有选择 <code>sass</code>，因为不需要安装那么久，并且加上对应插件也类似的写法，选择插件有：<code>postcss-cssnext</code>, <code>postcss-import</code>。这里也不需要安装 <code>Autoprefixer</code>，因为 cssnext 自带了</p>
<blockquote>
<p>vue 相关</p>
</blockquote>
<p>使用了 vue/vue-router/vuex/，没有用 <code>vue-resource</code>，选择了 <code>axios</code>，作者也推荐用 axios: <a href="https://medium.com/the-vue-point/retiring-vue-resource-871a82880af4">https://medium.com/the-vue-point/retiring-vue-resource-871a82880af4</a></p>
<h3 id="项目构建">项目构建</h3><p>有几个构建要求，分离相关基础库，修改 js，css 互不影响缓存</p>
<blockquote>
<p>分离 css</p>
</blockquote>
<p>使用 <code>webpack-md5-hash</code> 插件，使用 <code>contenthash</code> 文件名，保证修改 js 不会影响 css</p>

    <div class="hljs javascript">
      <table>
        <tbody>
          <tr>
            <td class="line">
              <pre><span>1</span>
<span>2</span>
<span>3</span>
<span>4</span>
<span>5</span>
<span>6</span>
<span>7</span>
<span>8</span>
<span>9</span>
<span>10</span>
<span>11</span>
<span>12</span>
<span>13</span>
<span>14</span>
<span>15</span>
<span>16</span>
</pre>
            </td>
            <td class="code"><pre><span class="hljs-attribute">loaders</span>: {
  <span class="hljs-attribute">postcss</span>: ExtractTextPlugin.extract({
    <span class="hljs-attribute">use</span>: [
      {
        <span class="hljs-attribute">loader</span>: <span class="hljs-string">'css-loader'</span>,
        <span class="hljs-attribute">options</span>: {
          <span class="hljs-attribute">minimize</span>: true
        }
      },
      <span class="hljs-string">'postcss-loader'</span>
    ],
    <span class="hljs-attribute">fallback</span>: <span class="hljs-string">'vue-style-loader'</span>
  })
}
...
<span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">ExtractTextPlugin</span>(<span class="hljs-string">'[name].[contenthash:8].css'</span>)</pre></td>
          </tr>
        </tbody>
      </table>
    </div>
  <blockquote>
<p>提取公共库</p>
</blockquote>
<p>基本上不会修改这些基础库</p>

    <div class="hljs javascript">
      <table>
        <tbody>
          <tr>
            <td class="line">
              <pre><span>1</span>
<span>2</span>
<span>3</span>
<span>4</span>
<span>5</span>
<span>6</span>
<span>7</span>
<span>8</span>
<span>9</span>
</pre>
            </td>
            <td class="code"><pre>{
  <span class="hljs-attribute">entry</span>: {
    vendors: [<span class="hljs-string">'axios'</span>, <span class="hljs-string">'vue'</span>, <span class="hljs-string">'vuex'</span>, <span class="hljs-string">'vue-router'</span>]
  }
}
...
<span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">webpack</span><span class="hljs-selector-class">.optimize</span><span class="hljs-selector-class">.CommonsChunkPlugin</span>({
  <span class="hljs-attribute">names</span>: [<span class="hljs-string">'vendors'</span>, <span class="hljs-string">'manifest'</span>]
})</pre></td>
          </tr>
        </tbody>
      </table>
    </div>
  <p>使用 <code>html-webpack-plugin</code> 进行自动生成相应资源路径，然后生成的 html 会有 4 个资源路径</p>

    <div class="hljs html">
      <table>
        <tbody>
          <tr>
            <td class="line">
              <pre><span>1</span>
<span>2</span>
<span>3</span>
<span>4</span>
<span>5</span>
<span>6</span>
</pre>
            </td>
            <td class="code"><pre><span class="hljs-built_in">..</span>.
&lt;link <span class="hljs-attribute">href</span>=<span class="hljs-string">"/build.0570f616.css"</span> <span class="hljs-attribute">rel</span>=<span class="hljs-string">"stylesheet"</span>&gt;
<span class="hljs-built_in">..</span>.
&lt;script <span class="hljs-attribute">type</span>=<span class="hljs-string">"text/javascript"</span> <span class="hljs-attribute">src</span>=<span class="hljs-string">"/manifest.d41d8cd9.js"</span>&gt;&lt;/script&gt;
&lt;script <span class="hljs-attribute">type</span>=<span class="hljs-string">"text/javascript"</span> <span class="hljs-attribute">src</span>=<span class="hljs-string">"/vendors.a2c4ab5a.js"</span>&gt;&lt;/script&gt;
&lt;script <span class="hljs-attribute">type</span>=<span class="hljs-string">"text/javascript"</span> <span class="hljs-attribute">src</span>=<span class="hljs-string">"/build.be4b1392.js"</span>&gt;&lt;/script&gt;</pre></td>
          </tr>
        </tbody>
      </table>
    </div>
  <p>这里有个问题，虽然现在修改 js，css 文件不会改变，反过来 css 修改 js 也不会改变，但是每次生成的 manifest.xxxxxx.js 可能文件名不一样，但是内容也变化了，这里有一个 issue: <a href="https://github.com/erm0l0v/webpack-md5-hash/issues/9">https://github.com/erm0l0v/webpack-md5-hash/issues/9</a></p>
<p>并且这个 manifest.js 是很小的，纪录一些打包模块信息，单独出来产生一个请求觉得不太好，所以这里选择将这个文件 inject 到 html，这样也可以不管上面所说的文件不一致问题</p>
<p>使用 <code>html-webpack-inline-source-plugin</code> 将 manifest inline 到 index.html</p>

    <div class="hljs javascript">
      <table>
        <tbody>
          <tr>
            <td class="line">
              <pre><span>1</span>
<span>2</span>
<span>3</span>
<span>4</span>
<span>5</span>
</pre>
            </td>
            <td class="code"><pre><span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">HtmlWebpackPlugin</span>({
  <span class="hljs-attribute">template</span>: <span class="hljs-string">'src/index.html'</span>,
  inject: <span class="hljs-string">'body'</span>,
  inlineSource: <span class="hljs-string">'manifest+'</span> // 将 manifest 开头的 inline script
})</pre></td>
          </tr>
        </tbody>
      </table>
    </div>
  <h3 id="路由选择">路由选择</h3><p>vue-router 也有两种路由模式选择，hash 模式以及 history 模式，history 模式需要服务器支持。因为项目是寄存在 GitHub pages 上，不能配置服务器，但这里还是使用了 history 模式，参考这里: <a href="https://github.com/LoeiFy/Recordum/issues/15">https://github.com/LoeiFy/Recordum/issues/15</a></p>
<p>因为 GitHub pages 支持 404.html，所以直接将生成的 index.html 复制生成一份 404.html，那么访问不存在路径就直接访问 404.html，就相当于访问 index.html，虽然这时候的 http code 是 404，但整个项目功能并没有受到影响</p>
</div>

    <div class="comments">
        <div id="disqus_thread"></div>
    </div>

</div>


</div>
</div>

<div class="footer">
    <div class="center">Recordum / Powered by <a target="_blank" href="https://github.com/acyortjs/acyort">AcyOrt</a> & <a target="_blank" href="https://github.com">GitHub</a></div>
</div>







</body>
</html>
